<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoLink+ - Secure Voice Calls</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <p id="status-message">Initializing...</p>

        <h1>EchoLink+</h1>

        <!-- Login -->
        <div id="login-view">
            <h2>Connect with friends</h2>
            <form id="loginForm">
                <input type="text" id="usernameInput" placeholder="Enter your Echo-Name" required>
                <button type="submit">Login</button>
            </form>
        </div>

        <!-- App -->
        <div id="app-view" class="hidden">
            <div class="logged-info">
                <p>Logged in as: <span id="logged-username"></span></p>
                <button id="logoutButton" class="small-button">Logout</button>
            </div>

            <h2>Available Users</h2>
            <ul id="user-list">
                <li><p class="placeholder-text">Loading users...</p></li>
            </ul>

            <div id="call-timer" class="hidden">00:00</div>

            <div id="call-controls" class="hidden">
                <button id="hangupButton" class="control-button danger">End Call</button>
                <button id="muteButton" class="control-button warning">Mute</button>
                <button id="unmuteButton" class="control-button warning hidden">Unmute</button>
            </div>

            <audio id="remoteAudio" autoplay></audio>
            <audio id="localAudio" autoplay muted></audio>
        </div>
    </div>

    <!-- Incoming Call Modal -->
    <div id="incoming-call-modal" class="hidden">
        <div id="incoming-call-content">
            <h2 id="incoming-caller-name">Incoming call from [Caller Name]</h2>
            <div id="modal-buttons">
                <button id="acceptCallButton" class="modal-button success">Accept</button>
                <button id="rejectCallButton" class="modal-button danger">Reject</button>
            </div>
        </div>
    </div>

    <audio id="ringtone" src="sounds/ringtone.mp3" loop preload="auto"></audio>

    <footer>
        &copy; <span id="currentYear"></span> EchoLink+
    </footer>

    <script src="app.js"></script>
    <script>
        // Update footer year
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // Check for saved username on page load (persistent login)
        window.addEventListener('load', () => {
            const savedUser = localStorage.getItem('echoname');
            if (savedUser) {
                document.getElementById('usernameInput').value = savedUser;
                // Trigger login through app.js function
                handleLogin(savedUser);
            }
        });
    </script>
</body>
</html>
